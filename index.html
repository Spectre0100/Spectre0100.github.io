<!DOCTYPE html>
<html>

  <head>
    <title>DLR Arrival Times</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cabin:ital,wght@0,400..700;1,400..700&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">
    <meta http-equiv="refresh" content="5">
    <style>
      body {
        font-family: 'Lato', sans-serif;
        margin: 0;
        padding: 0;
        background-color: #000;
        color: #eee;
      }

      header {
        color: #eee;
        background-color: #00109f;
        padding: 20px;
        text-align: center;
      }

      main {
        padding: 20px;
        text-align: center;
      }

      table {
        margin: 0 auto;
        border-collapse: collapse;
        border-left: none;
        border-right: none;
        width: 80%;
        max-width: 600px;
        background-color: #000;
      }

      th,
      td {
        border: 1px solid #2d2d2d;
        border-left: none;
        border-right: none;
        border-top: none;
        padding: 10px;
      }

      tr {
        border: 0px solid #00afa9;
        padding: 10px;
      }

      th {
        background-color: #00afa9;
        color: #FFFFFF;
        font-weight: bold;
      }

      p {
        font-size: 20px;
        margin-bottom: 20px;
        font-weight: bold;
      }

    </style>
  </head>

  <body>

    <!-- Header Section -->
    <header>
      <h1>
        TFL Arrival Times
      </h1>
    </header>

    <!-- Body section -->
    <main>
      <section id="Content">
        <!-- <h2>Arrivals</h2> -->
        <p id="BLAStation"></p>
        <table>
          <thead>
            <tr>
              <th>Destination</th>
              <th>Time</th>
            </tr>
          </thead>
          <tbody id="BLA">
            <!-- <tr>
              <td id="blaDest1">-</td>
              <td id="blaTime1">-</td>
            </tr>
            <tr>
              <td id="blaDest2">-</td>
              <td id="blaTime2">-</td>
            </tr>
            <tr>
              <td id="blaDest3">-</td>
              <td id="blaTime3">-</td>
            </tr> -->
          </tbody>
        </table>
        <p id="TWGStation"></p>
        <table>
          <thead>
            <tr>
              <th>Destination</th>
              <th>Time</th>
            </tr>
          </thead>
          <tbody id="TWG">
            <!-- <tr>
              <td id="twgDest1">-</td>
              <td id="twgTime1">-</td>
            </tr>
            <tr>
              <td id="twgDest2">-</td>
              <td id="twgTime2">-</td>
            </tr>
            <tr>
              <td id="twgDest3">-</td>
              <td id="twgTime3">-</td>
            </tr> -->
          </tbody>
        </table>
      </section>
    </main>

    <script>
      const url_bla = 'https://api.digital.tfl.gov.uk/Line/dlr/Arrivals/940GZZDLBLA?direction=inbound';
      const url_twg = 'https://api.digital.tfl.gov.uk/stoppoint/940GZZDLTWG/Arrivals';
      const url_can = 'https://api.tfl.gov.uk/Line/{ids}/Arrivals/{stopPointId}[?direction]';

      getName = function(s) {
        if (s.includes('Tower')) {
          return s.split(' ').slice(0, 2).join(' ');
        }
        return s.split(' ')[0];
      }

      // Fetch BLA data
      fetch(url_bla)
        .then(response => response.json())
        .then(data => {
          let arrivalsBLA = [];
          for (const arrival in data) {
            arrivalsBLA.push({
              'dest': getName(data[arrival].destinationName),
              'time': Math.round(data[arrival].timeToStation / 60)
            });
          }
          arrivalsBLA.sort((a, b) => a.time - b.time)
          // Get first three arrivals only
          arrivalsBLA = arrivalsBLA.slice(0,3);
          console.log(arrivalsBLA);
          document.getElementById('BLAStation').innerText = getName(data[0].stationName)
          // Iterate over data and populate table rows in order
          const tableBody = document.getElementById('BLA');
          for (const arrival in arrivalsBLA) {
            const row = document.createElement('tr');
            const destinationCell = document.createElement('td');
            destinationCell.textContent = arrivalsBLA[arrival].dest;
            const timeToArrivalCell = document.createElement('td');
            timeToArrivalCell.textContent = arrivalsBLA[arrival].time + " min";
            row.appendChild(destinationCell);
            row.appendChild(timeToArrivalCell);
            tableBody.appendChild(row); // Append row to table body
          }})
        .catch(error => {
          throw new Error("Error fetching data");
        });

      // Fetch TWG data
      fetch(url_twg)
        .then(response => response.json())
        .then(data => {
          let arrivalsTWG = [];
          for (const arrival in data) {
            arrivalsTWG.push({
              'dest': getName(data[arrival].destinationName),
              'time': Math.round(data[arrival].timeToStation / 60)
            });
          }
          arrivalsTWG.sort((a, b) => a.time - b.time)
          // Get first three arrivals only
          arrivalsTWG = arrivalsTWG.slice(0,3);
          console.log(arrivalsTWG);
          document.getElementById('TWGStation').innerText = getName(data[0].stationName)
          // Iterate over data and populate table rows in order
          const tableBody = document.getElementById('TWG');
          for (const arrival in arrivalsTWG) {
            const row = document.createElement('tr');
            const destinationCell = document.createElement('td');
            destinationCell.textContent = arrivalsTWG[arrival].dest;
            const timeToArrivalCell = document.createElement('td');
            timeToArrivalCell.textContent = arrivalsTWG[arrival].time + " min";
            row.appendChild(destinationCell);
            row.appendChild(timeToArrivalCell);
            tableBody.appendChild(row); // Append row to table body
          }})
        .catch(error => {
          throw new Error("Error fetching data");
        });

    </script>

  </body>

</html>
